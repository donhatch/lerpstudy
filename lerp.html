<!DOCTYPE html>
<html>
 <head>
  <title>Lerp study</title>

  <link rel="icon" type="image/png" href="lerp-favicon.png" />

  <!--
    NOTE: this apparently requires a real server; e.g. `python -m SimpleHTTPServer`;
    otherwise I get console errors, and presumably stuff then doesn't work:
      STRINGIFY.js:229     out STRINGIFY.js define callback, returning STRINGIFYsmart
      lerp.html:1 Access to XMLHttpRequest at 'file:///home/donhatch/gitrepos/misc/lerp.js' from origin 'null' has been blocked by CORS policy: Cross origin requests are only supported for protocol schemes: http, data, chrome, chrome-extension, chrome-untrusted, https.
      text.js:329 GET file:///home/donhatch/gitrepos/misc/lerp.js net::ERR_FAILED
  -->
  <script src="require.js"></script>
  <script src="registerSourceCodeLinesAndRequire.js"></script>
  <script src="lerp.js"></script>
 </head>
 <style>

   /* monospace font, preserve spaces */
   .mono {
     font-family: monospace;
     white-space: pre;
   }

 </style>
 <body>
  <h2>Lerp study</h2>
  lerp function: <span class="mono"><span id="theTitle"></span>   <span id="theTitlePart2"></span></span>
  <table style="border: 0px solid black;">
   <tr>
    <td rowspan="2" style="border: 0px solid black;">
     <div id="theSVGholder" style="width:512px; height:1024px;">  <!-- XXX need to control this from inside -->
      <svg id="theSVG"></svg>
     </div>
    </td>
    <td valign="top">
     <div style="border: 1px solid black;">

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodExactCrossYourFingers" name="lerpmethod" value="lerpmethodExactCrossYourFingers">
       exact (rounded to nearest representable with ties rounded to even)
      </label>
      <br>

      <br>
      <label>
        <input type="radio" class="lerpmethodRadioButton" id="lerpmethodNaive" name="lerpmethod" value="lerpmethodNaive">
        <span class="mono">(1-t)*a + t*b</span>
      </label>
      <br>

      <br>
      <label>
        <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTypeMeaningful" name="lerpmethod" value="lerpmethodTypeMeaningful">
        <span class="mono">a + t*(b-a)</span>
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTypeMeaningfulBackwards" name="lerpmethod" value="lerpmethodTypeMeaningfulBackwards">
       <span class="mono">b - (1-t)*(b-a)</span>
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodBidirectional" name="lerpmethod" value="lerpmethodBidirectional">
       <span class="mono">t &lt; 0.5 ? a + t*(b-a) : b - (1-t)*(b-a)</span>
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodBidirectionalAlt" name="lerpmethod" value="lerpmethodBidirectionalAlt">
       <span class="mono">t &lt;= 0.5 ? a + t*(b-a) : b - (1-t)*(b-a)</span>
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodBidirectionalAlt3" name="lerpmethod" value="lerpmethodBidirectionalAlt3">
       <span class="mono">t &lt; 0.5 ? a + t*(b-a) : t &gt; 0.5 ? b - (1-t)*(b-a) : (a+b)/2</span>
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodMaybe" name="lerpmethod" value="lerpmethodMaybe">
       <span class="mono">answer0 = (1-t)*a + t*b; answer0 += ((1-t)*(a-answer0) + t*(b-answer0)</span>
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodMaybe2" name="lerpmethod" value="lerpmethodMaybe2">
       <span class="mono">answer0 = a+t(b-a); answer1 = b-(1-t)(b-a); answer = (1-t)*answer0 + t*answer1</span>
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTBlast" name="lerpmethod" value="lerpmethodTBlast">
       <span class="mono">a - t*a + t*b</span>
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTBlastAtTwicePrecision" name="lerpmethod" value="lerpmethodTBlastAtTwicePrecision">
       at twice precision
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodAlast" name="lerpmethod" value="lerpmethodAlast">
       <span class="mono">t*b - t*a + a</span>
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodAlastAtTwicePrecision" name="lerpmethod" value="lerpmethodAlastAtTwicePrecision">
       at twice precision
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTAlast" name="lerpmethod" value="lerpmethodTAlast">
       <span class="mono">a + t*b - t*a</span>
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTAlastAtTwicePrecision" name="lerpmethod" value="lerpmethodTAlastAtTwicePrecision">
       at twice precision
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTBlastUsingDot" name="lerpmethod" value="lerpmethodTBlastUsingDot">
       <span class="mono">[1,-t,t] <big>&#8226;</big> [a,a,b]</span> using Kahan-ish summation
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTBlastUsingDotTweaked" name="lerpmethod" value="lerpmethodTBlastUsingDotTweaked">
       tweaked
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTBlastUsingDotSmarter" name="lerpmethod" value="lerpmethodTBlastUsingDotSmarter">
       smarter
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTBlastUsingDotSmartest" name="lerpmethod" value="lerpmethodTBlastUsingDotSmartest">
       smartest
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodAlastUsingDot" name="lerpmethod" value="lerpmethodAlastUsingDot">
       <span class="mono">[t,-t,1] <big>&#8226;</big> [b,a,a]</span> using Kahan-ish summation
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodAlastUsingDotTweaked" name="lerpmethod" value="lerpmethodAlastUsingDotTweaked">
       tweaked
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodAlastUsingDotSmarter" name="lerpmethod" value="lerpmethodAlastUsingDotSmarter">
       smarter
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodAlastUsingDotSmartest" name="lerpmethod" value="lerpmethodAlastUsingDotSmartest">
       smartest
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTAlastUsingDot" name="lerpmethod" value="lerpmethodTAlastUsingDot">
       <span class="mono">[1,t,-t] <big>&#8226;</big> [a,b,a]</span> using Kahan-ish summation
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTAlastUsingDotTweaked" name="lerpmethod" value="lerpmethodTAlastUsingDotTweaked">
       tweaked
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTAlastUsingDotSmarter" name="lerpmethod" value="lerpmethodTAlastUsingDotSmarter">
       smarter
      </label>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodTAlastUsingDotSmartest" name="lerpmethod" value="lerpmethodTAlastUsingDotSmartest">
       smartest&nbsp;
      </label>
      <br>

      <br>
      <label>
       <input type="radio" class="lerpmethodRadioButton" id="lerpmethodMagic" name="lerpmethod" value="lerpmethodMagic">
       magically exact (using exact sum expansions-- doesn't work yet apparently)
      </label>
      <br>


      <br>

     </div>

     <div style="border: 1px solid black;">
     <pre>
Help:
  '-' - decrease num fraction bits
  '+'/'=' - increase num fraction bits
  Up/Down arrow: move whichever of a or b is closest to mouse cursor

Red horizontal lines are a and b.
Line surrounded by green dots is the exact lerp function.
(Line surrounded by red dots is the same, but with a and b interchanged.)
The green dots are the approximations to it using the chosen function.
A green dot is circled if it's not the exactly correct answer rounded to nearest representable using the round-ties-to-even rule.
Hovering over a dot shows, in fractions and binary:
  - t
  - [exact rounded down, exact, (halfway between exact rounded down and up), exact rounded up] in sorted order
  - the computed lerp(a,b,t) and whether it's correct or wrong.
A larger yellow dot means the point is both a green dot and a red dot.
The slope of the gray slanted lines is (b-a) rounded to the nearest representable number.
<pre></div>  <!-- end the elements on same line to avoid spurious vertical space -->
    </td>
   </tr>
  </table>

  <!-- https://stackoverflow.com/questions/10643426/how-to-add-a-tooltip-to-an-svg-graphic#answer-50543963 -->
  <div id="tooltip" display="none" style="position:absolute; display:none; background-color:white; border: 1px solid black;"></div>

   <br>
   <hr>
   Related links:
   <ul>
    <li><a href="https://stackoverflow.com/questions/4353525/floating-point-linear-interpolation">https://stackoverflow.com/questions/4353525/floating-point-linear-interpolation</a>
    <li><a href="https://math.stackexchange.com/questions/907327/accurate-floating-point-linear-interpolation">https://math.stackexchange.com/questions/907327/accurate-floating-point-linear-interpolation</a>
 </body>
</html>
